// This config is in the KDL format: https://kdl.dev
// "/-" comments out the following node.
// Check the wiki for a full description of the configuration:
// https://github.com/YaLTeR/niri/wiki/Configuration:-Introduction
config-notification {
    disable-failed
}
/// ────────────── Output Configuration ──────────────

output "eDP-1" {
    mode "1920x1200" // Set resolution
    scale 1.333
    variable-refresh-rate
}

output "HDMI-A-1" {
  mode "1920x1080"
}

gestures {
    hot-corners {
        off
    }
}

// ────────────── Input Configuration ──────────────

input {

    keyboard {
        xkb {
          layout "us" // Enables US layout
        }
        numlock
    }

    touchpad {
      tap // Enables tap-to-click
      natural-scroll // Enables natural scrolling
    }

    mouse {
    }

    trackpoint {
    }

    focus-follows-mouse // Automatically focus windows under the mouse pointer
}

// ────────────── Layout Settings ──────────────

layout {
  // Set gaps around windows in logical pixels.
  gaps 5
  background-color "transparent"
  center-focused-column "never"

  preset-column-widths {
      proportion 0.25
      proportion 0.5
      proportion 0.75
      proportion 1.0
  }
  // You can also customize the heights that "switch-preset-window-height" (Mod+Shift+R) toggles between.
  
  preset-window-heights { 
      proportion 0.33333
      proportion 0.5
      proportion 0.66666
      proportion 1.0
  }

  default-column-width { proportion 0.5; }

  border {
      width 2
      active-color "#e20340"
      inactive-color "#1f1a2d" 
  }

  focus-ring {
    off
      width 2
      active-color   "#e20340" 
      inactive-color "#14b4b4"     
  }

  shadow {
      softness 30
      spread 5
      offset x=0 y=5
      color "#0007"
  }
}

layer-rule {
    match namespace="^quickshell$"
    place-within-backdrop true
}

overview {  
  zoom 0.70
  backdrop-color "#0e091d"
    workspace-shadow {
        off
    }
}

// ────────────── Startup Applications ──────────────

spawn-at-startup "bash" "-c" "wl-paste --watch cliphist store &"
spawn-at-startup "/usr/lib/polkit-kde-authentication-agent-1 &"

// ────────────── Environment Variables ──────────────

environment {
  DISPLAY ":0"
  QT_WAYLAND_DISABLE_WINDOWDECORATION "1"
  XDG_CURRENT_DESKTOP "niri"
  QT_QPA_PLATFORM "wayland"
  ELECTRON_OZONE_PLATFORM_HINT "auto"
  QT_QPA_PLATFORMTHEME "gtk3"
  QT_QPA_PLATFORMTHEME_QT6 "gtk3"
  TERMINAL "alacritty"
}

hotkey-overlay {
    skip-at-startup
}

prefer-no-csd

screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

// ────────────── Animation Settings ──────────────

animations {
  workspace-switch {
      spring damping-ratio=0.60 stiffness=523 epsilon=0.0001
  }
  window-open {
      duration-ms 150
      curve "ease-out-expo"
  }
  window-close {
      duration-ms 150
      curve "ease-out-quad"
  }
  horizontal-view-movement {
      spring damping-ratio=0.65 stiffness=423 epsilon=0.0001
  }
  window-movement {
      spring damping-ratio=0.55 stiffness=323 epsilon=0.0001
  }
  window-resize {
      spring damping-ratio=0.65 stiffness=423 epsilon=0.0001
  }
  config-notification-open-close {
      spring damping-ratio=0.45 stiffness=923 epsilon=0.001
  }
  screenshot-ui-open {
      duration-ms 200
      curve "ease-out-quad"
  }
  overview-open-close {
      spring damping-ratio=0.65 stiffness=800 epsilon=0.0001
  }
}

// ────────────── Window Rules ──────────────

window-rule {
    match app-id=r#"^org\.gnome\."#
    draw-border-with-background false
    geometry-corner-radius 12
    clip-to-geometry true
}

window-rule {
    match app-id=r#"^gnome-control-center$"#
    match app-id=r#"^pavucontrol$"#
    match app-id=r#"^nm-connection-editor$"#
    default-column-width { proportion 0.5; }
    open-floating false
}

window-rule {
    match app-id=r#"^gnome-calculator$"#
    match app-id=r#"^galculator$"#
    match app-id=r#"^blueman-manager$"#
    match app-id=r#"^org\.gnome\.Nautilus$"#
    match app-id=r#"^steam$"#
    match app-id=r#"^xdg-desktop-portal$"#
    open-floating true
}

window-rule {
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    match app-id="Alacritty"
    match app-id="zen"
    match app-id="com.mitchellh.ghostty"
    match app-id="kitty"
    draw-border-with-background false
}

window-rule {
    match is-active=false
    opacity 0.9
}

window-rule {
    match app-id="firefox"
    open-maximized true
}

window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    match app-id="zoom"
    open-floating true
}

window-rule {
    geometry-corner-radius 3
    clip-to-geometry true
}

// ────────────── Keybindings ──────────────

binds {
  MOD+SHIFT+ESCAPE                    { show-hotkey-overlay; }

  // ─── Applications ───
  Super+Alt+L                         hotkey-overlay-title="Lock Screen" { spawn "dms" "ipc" "call" "lock" "lock"; }
 
  MOD+RETURN                          hotkey-overlay-title="Open Terminal: alacritty"  { spawn-sh "alacritty"; }
  MOD+B                               hotkey-overlay-title="Open Browser: firefox" { spawn-sh "firefox"; }
  MOD+E                               hotkey-overlay-title="File Manager: Nautilus" { spawn-sh "nautilus"; }
  MOD+Comma                           hotkey-overlay-title="Settings" { spawn "dms" "ipc" "call" "settings" "toggle"; }
  MOD+P                               hotkey-overlay-title="Notepad" { spawn "dms" "ipc" "call" "notepad" "toggle"; }

  MOD+Space                           hotkey-overlay-title="Application Launcher" { spawn "dms" "ipc" "call" "spotlight" "toggle"; }
  MOD+V                               hotkey-overlay-title="Clipboard Manager" { spawn "dms" "ipc" "call" "clipboard" "toggle"; }
  MOD+M                               hotkey-overlay-title="Task Manager" { spawn "dms" "ipc" "call" "processlist" "toggle"; }
  MOD+N                               hotkey-overlay-title="NeoVim" { spawn "alacritty" "-e" "nv"; }
  Mod+X                               hotkey-overlay-title="Power Menu" { spawn "dms" "ipc" "call" "powermenu" "toggle"; }
  Mod+C                               hotkey-overlay-title="Control Center" { spawn "dms" "ipc" "call" "control-center" "toggle"; }
  Mod+Y                               hotkey-overlay-title="Browse Wallpapers" { spawn "dms" "ipc" "call" "dankdash" "wallpaper"; }

  // ─── Audio Controls ───
  XF86AudioRaiseVolume                allow-when-locked=true { spawn "dms" "ipc" "call" "audio" "increment" "3"; }
  XF86AudioLowerVolume                allow-when-locked=true { spawn "dms" "ipc" "call" "audio" "decrement" "3"; }
  XF86AudioMute                       allow-when-locked=true { spawn "dms" "ipc" "call" "audio" "mute"; }
  XF86AudioMicMute                    allow-when-locked=true { spawn "dms" "ipc" "call" "audio" "micmute"; }

  // ─── Brightness Controls ───
  XF86MonBrightnessUp                 allow-when-locked=true { spawn "dms" "ipc" "call" "brightness" "increment" "5" ""; }
  XF86MonBrightnessDown               allow-when-locked=true { spawn "dms" "ipc" "call" "brightness" "decrement" "5" ""; }

  // ─── Window Movement and Focus ───
  MOD+W                               { close-window; }

  MOD+LEFT                            { focus-column-left; }
  MOD+H                               { focus-column-left; }
  MOD+RIGHT                           { focus-column-right; }
  MOD+L                               { focus-column-right; }
  MOD+UP                              { focus-window-up; }
  MOD+K                               { focus-window-up; }
  MOD+DOWN                            { focus-window-down; }
  MOD+J                               { focus-window-down; }

  MOD+SHIFT+LEFT                      { move-column-left; }
  MOD+SHIFT+H                         { move-column-left; }
  MOD+SHIFT+RIGHT                     { move-column-right; }
  MOD+SHIFT+L                         { move-column-right; }
  MOD+SHIFT+UP                        { move-window-up; }
  MOD+SHIFT+K                         { move-window-up; }
  MOD+SHIFT+DOWN                      { move-window-down; }
  MOD+SHIFT+J                         { move-window-down; }

  MOD+Q                               { consume-window-into-column; }
  MOD+SHIFT+Q                         { expel-window-from-column; }

  MOD+HOME                            { focus-column-first; }
  MOD+END                             { focus-column-last; }
  MOD+CTRL+HOME                       { move-column-to-first; }
  MOD+CTRL+END                        { move-column-to-last; }

  MOD+CTRL+LEFT                       { focus-monitor-left; }
  MOD+CTRL+RIGHT                      { focus-monitor-right; }
  MOD+CTRL+UP                         { focus-monitor-up; }
  MOD+CTRL+DOWN                       { focus-monitor-down; }

  MOD+SHIFT+CTRL+LEFT                 { move-column-to-monitor-left; }
  MOD+SHIFT+CTRL+RIGHT                { move-column-to-monitor-right; }
  MOD+SHIFT+CTRL+UP                   { move-column-to-monitor-up; }
  MOD+SHIFT+CTRL+DOWN                 { move-column-to-monitor-down; }

  // ─── Workspace Switching ───
  MOD+WHEELSCROLLDOWN                 cooldown-ms=150 { focus-workspace-down; }
  MOD+WHEELSCROLLUP                   cooldown-ms=150 { focus-workspace-up; }
  MOD+CTRL+WHEELSCROLLDOWN            cooldown-ms=150 { move-column-to-workspace-down; }
  MOD+CTRL+WHEELSCROLLUP              cooldown-ms=150 { move-column-to-workspace-up; }

  MOD+WHEELSCROLLRIGHT                { focus-column-right; }
  MOD+WHEELSCROLLLEFT                 { focus-column-left; }
  MOD+CTRL+WHEELSCROLLRIGHT           { move-column-right; }
  MOD+CTRL+WHEELSCROLLLEFT            { move-column-left; }

  MOD+SHIFT+WHEELSCROLLDOWN           { focus-column-right; }
  MOD+SHIFT+WHEELSCROLLUP             { focus-column-left; }
  MOD+CTRL+SHIFT+WHEELSCROLLDOWN      { move-column-right; }
  MOD+CTRL+SHIFT+WHEELSCROLLUP        { move-column-left; }

  MOD+1                               { focus-workspace 1; }
  MOD+2                               { focus-workspace 2; }
  MOD+3                               { focus-workspace 3; }
  MOD+4                               { focus-workspace 4; }
  MOD+5                               { focus-workspace 5; }
  MOD+6                               { focus-workspace 6; }
  MOD+7                               { focus-workspace 7; }
  MOD+8                               { focus-workspace 8; }
  MOD+9                               { focus-workspace 9; }

  MOD+SHIFT+1                         { move-column-to-workspace 1; }
  MOD+SHIFT+2                         { move-column-to-workspace 2; }
  MOD+SHIFT+3                         { move-column-to-workspace 3; }
  MOD+SHIFT+4                         { move-column-to-workspace 4; }
  MOD+SHIFT+5                         { move-column-to-workspace 5; }
  MOD+SHIFT+6                         { move-column-to-workspace 6; }
  MOD+SHIFT+7                         { move-column-to-workspace 7; }
  MOD+SHIFT+8                         { move-column-to-workspace 8; }
  MOD+SHIFT+9                         { move-column-to-workspace 9; }

  MOD+TAB                             { focus-workspace-previous; }

  // ─── Layout Controls ───
  MOD+F                               { expand-column-to-available-width; }
  MOD+SHIFT+C                         { center-column; }
  MOD+CTRL+C                          { center-visible-columns; }
  MOD+MINUS                           { set-column-width "-10%"; }
  MOD+EQUAL                           { set-column-width "+10%"; }
  MOD+SHIFT+MINUS                     { set-window-height "-10%"; }
  MOD+SHIFT+EQUAL                     { set-window-height "+10%"; }

  MOD+R                               { switch-preset-column-width; }
  MOD+SHIFT+R                         { switch-preset-window-height; }

  // ─── Modes ───
  MOD+T                               { toggle-window-floating; }
  MOD+SHIFT+F                         { fullscreen-window; }
  MOD+S                               { toggle-column-tabbed-display; }

  // ─── Emergency Escape Key ───
  // Use this when a fullscreen app blocks your keybinds.
  // It disables any active keyboard shortcut inhibitor, restoring control.
  MOD+ESCAPE                          allow-inhibiting=false { toggle-keyboard-shortcuts-inhibit; }

  // ─── Exit / Power ───
  CTRL+ALT+DELETE                     { quit; } // Also quits Niri
  MOD+SHIFT+P                         { power-off-monitors; } // Turn off screens (useful for OLED or privacy)
  MOD+O                               repeat=false { toggle-overview; }

  // === Screenshots ===
  PRINT                               { screenshot; }
  CTRL+PRINT                          { screenshot-screen; }
  ALT+PRINT                           { screenshot-window; }

}

debug {
    honor-xdg-activation-with-invalid-serial
}
